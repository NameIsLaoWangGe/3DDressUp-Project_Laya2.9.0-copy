{
  "code": "import { Admin, DataAdmin, EventAdmin, Tools } from \"./Lwg\";\r\nimport { _Res } from \"./_PreLoad\";\r\nexport var _Tailor;\r\n(function (_Tailor) {\r\n    let _Event;\r\n    (function (_Event) {\r\n        _Event[\"trigger\"] = \"_MakeClothes_trigger\";\r\n        _Event[\"playAni\"] = \"_MakeClothes_playAni\";\r\n    })(_Event = _Tailor._Event || (_Tailor._Event = {}));\r\n    class DottedLine extends DataAdmin._Table {\r\n        constructor(Root, LineParent, OwnerScene) {\r\n            super();\r\n            this.Root = Root;\r\n            this.LineParent = LineParent;\r\n            this.OwnerScene = OwnerScene;\r\n            for (let index = 0; index < this.LineParent.numChildren; index++) {\r\n                const Line = this.LineParent.getChildAt(index);\r\n                if (Line.numChildren > 0) {\r\n                    let data = {};\r\n                    data['Line'] = Line;\r\n                    data[this._property.name] = Line.name;\r\n                    data[this._property.conditionNum] = Line.numChildren;\r\n                    data[this._property.degreeNum] = 0;\r\n                    this._arr.push(data);\r\n                }\r\n            }\r\n        }\r\n        removeCloth(name) {\r\n            this.LineParent.getChildByName(name).removeSelf();\r\n            let Cloth = this.Root.getChildByName(`Cloth${name.substr(4)}`);\r\n            if (Cloth) {\r\n                let ani = this.OwnerScene[`ani${name.substr(4)}`];\r\n                ani.play(0, false);\r\n                ani.on(Laya.Event.COMPLETE, this, () => {\r\n                    Cloth.removeSelf();\r\n                    console.log('删除节点！');\r\n                });\r\n            }\r\n            else {\r\n                console.log('当前虚线上没有可以裁剪布料，请查看');\r\n            }\r\n        }\r\n    }\r\n    _Tailor.DottedLine = DottedLine;\r\n    class Scissor extends Admin._ObjectBase {\r\n        onTriggerEnter(other, self) {\r\n            console.log('裁剪！');\r\n            if (!other['cut']) {\r\n                other['cut'] = true;\r\n                EventAdmin._notify(_Event.trigger, [other.owner.parent.name]);\r\n            }\r\n        }\r\n    }\r\n    _Tailor.Scissor = Scissor;\r\n    class Tailor extends Admin._SceneBase {\r\n        constructor() {\r\n            super(...arguments);\r\n            this.Cutting = {\r\n                Scissor: () => {\r\n                    return this._ImgVar('Scissor');\r\n                },\r\n                touchP: new Laya.Point(),\r\n                maxSpeed: 30,\r\n                get diffP() {\r\n                    return this['_diffP'] ? this['_diffP'] : new Laya.Point();\r\n                },\r\n                set diffP(p) {\r\n                    p.x = p.x > this['maxSpeed'] ? this['maxSpeed'] : p.x;\r\n                    p.x = p.x < -this['maxSpeed'] ? -this['maxSpeed'] : p.x;\r\n                    p.y = p.y > this['maxSpeed'] ? this['maxSpeed'] : p.y;\r\n                    p.y = p.y < -this['maxSpeed'] ? -this['maxSpeed'] : p.y;\r\n                    this['_diffP'] = p;\r\n                },\r\n                EraserSp: () => {\r\n                    if (!this._ImgVar('LineParent').getChildByName('EraserSp')) {\r\n                        let Sp = new Laya.Sprite();\r\n                        Sp.name = 'EraserSp';\r\n                        Sp.blendMode = \"destination-out\";\r\n                        this._ImgVar('LineParent').addChild(Sp);\r\n                        return Sp;\r\n                    }\r\n                    else {\r\n                        return this._ImgVar('LineParent').getChildByName('EraserSp');\r\n                    }\r\n                },\r\n                EraserSize: 50,\r\n                erasureLine: () => {\r\n                    let gPos = this.Cutting.Scissor().parent.localToGlobal(new Laya.Point(this._ImgVar('Scissor').x, this._ImgVar('Scissor').y));\r\n                    let localPos = this.Cutting.EraserSp().globalToLocal(gPos);\r\n                    this.Cutting.EraserSp().graphics.drawCircle(localPos.x, localPos.y, this.Cutting.EraserSize / 2, \"#000000\");\r\n                }\r\n            };\r\n        }\r\n        lwgOnAwake() {\r\n            this.DottedLineControl = new DottedLine(this._ImgVar('Root'), this._ImgVar('LineParent'), this._Owner);\r\n            this.DottedLineControl.BtnCompelet = Tools._Node.createPrefab(_Res._list.prefab2D.BtnCompelet.prefab);\r\n            this._Owner.addChild(this.DottedLineControl.BtnCompelet);\r\n            this.DottedLineControl.BtnCompelet.pos(Laya.stage.width - 100, 150);\r\n            this.DottedLineControl.BtnCompelet.visible = false;\r\n            this._ImgVar('Scissor').addComponent(Scissor);\r\n            this._ImgVar('LineParent').cacheAs = \"bitmap\";\r\n        }\r\n        lwgAdaptive() {\r\n        }\r\n        lwgOpenAni() {\r\n            return 100;\r\n        }\r\n        lwgEventRegister() {\r\n            EventAdmin._register(_Event.trigger, this, (name) => {\r\n                let value = this.DottedLineControl._checkCondition(name);\r\n                if (value) {\r\n                    this.DottedLineControl.removeCloth(name);\r\n                    let boll = this.DottedLineControl._checkAllCompelet();\r\n                    if (boll) {\r\n                        this.DottedLineControl.BtnCompelet.visible = true;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        lwgBtnRegister() {\r\n            this._btnUp(this._ImgVar('BtnNext'), () => {\r\n                this._openScene('MakeClothes', true, true);\r\n            });\r\n            this._btnUp(this.DottedLineControl.BtnCompelet, () => {\r\n                this._openScene('MakeClothes', true, true);\r\n            });\r\n        }\r\n        onStageMouseDown(e) {\r\n            this.Cutting.touchP = new Laya.Point(e.stageX, e.stageY);\r\n        }\r\n        onStageMouseMove(e) {\r\n            if (this.Cutting.touchP) {\r\n                this.Cutting.diffP = new Laya.Point(e.stageX - this.Cutting.touchP.x, e.stageY - this.Cutting.touchP.y);\r\n                this.Cutting.Scissor().x += this.Cutting.diffP.x;\r\n                this.Cutting.Scissor().y += this.Cutting.diffP.y;\r\n                this.Cutting.erasureLine();\r\n                this.Cutting.touchP = new Laya.Point(e.stageX, e.stageY);\r\n            }\r\n        }\r\n        onStageMouseUp() {\r\n            this.Cutting.touchP = null;\r\n        }\r\n    }\r\n    _Tailor.Tailor = Tailor;\r\n})(_Tailor || (_Tailor = {}));\r\n",
  "references": [
    "D:/Game/project/3DDressUp/Project_Laya2.9.0/3DDressUp_Laya2.9.0/3DDressUp_Laya2.9.0/src/script/Lwg/Lwg.ts",
    "D:/Game/project/3DDressUp/Project_Laya2.9.0/3DDressUp_Laya2.9.0/3DDressUp_Laya2.9.0/src/script/Lwg/_PreLoad.ts"
  ]
}
